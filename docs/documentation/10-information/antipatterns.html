<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Anti-Patterns</title>
  
  
  <meta name="description" content="An FP game engine for Scala."/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/png" href="../../img/favicon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../helium/site/laika-helium.css" />
    <link rel="stylesheet" type="text/css" href="../../css/custom.css" />
  <script src="../../helium/site/laika-helium.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="../"><img src="../../img/indigo_logo_solid_text.svg" alt="An FP game engine for Scala." title="Indigo" width="150" height="50"></a>

  <div class="row links">
    
    <a class="button-link" href="https://purplekingdomgames.github.io/indigo-docs/demos">Live Demos</a>
    
    <a class="button-link" href="https://discord.gg/b5CD47g">Discord</a>
    
    <a class="button-link" href="https://github.com/PurpleKingdomGames/indigo">Github</a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="button-link" href="https://purplekingdomgames.github.io/indigo-docs/demos">Live Demos</a>
    
    <a class="button-link" href="https://discord.gg/b5CD47g">Discord</a>
    
    <a class="button-link" href="https://github.com/PurpleKingdomGames/indigo">Github</a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-node"><a href="../">Indigo</a></li>
    <li class="level2 nav-header">Setup &amp; Configuration</li>
    <li class="level3 nav-leaf"><a href="../01-quickstart/examples.html">Examples, Demos, and References</a></li>
    <li class="level3 nav-leaf"><a href="../01-quickstart/extensions-and-libs.html">Extensions, Libraries, and Related Projects</a></li>
    <li class="level3 nav-leaf"><a href="../01-quickstart/hello-indigo.html">Hello, Indigo!</a></li>
    <li class="level3 nav-leaf"><a href="../01-quickstart/project-templates.html">Mill &amp; SBT Templates</a></li>
    <li class="level3 nav-leaf"><a href="../01-quickstart/quickstart.html">Quick start</a></li>
    <li class="level2 nav-header">Guides</li>
    <li class="level3 nav-leaf"><a href="../02-guides/howto-custom-entity.html">How to make a custom entity</a></li>
    <li class="level3 nav-leaf"><a href="../02-guides/howto-fire-shader.html">How to write a fire shader</a></li>
    <li class="level3 nav-leaf"><a href="../02-guides/howto-hello-indigo-tyrian.html">How to make a responsive UI using Tyrian</a></li>
    <li class="level3 nav-leaf"><a href="../02-guides/howto-indigo-game.html">Converting <code>IndigoSandbox</code> to <code>IndigoGame</code></a></li>
    <li class="level2 nav-header">Gameloop</li>
    <li class="level3 nav-leaf"><a href="../03-gameloop/events.html">Events</a></li>
    <li class="level3 nav-leaf"><a href="../03-gameloop/frame-context.html">Frame context</a></li>
    <li class="level3 nav-leaf"><a href="../03-gameloop/outcome.html">Outcome Type</a></li>
    <li class="level2 nav-header">Organisation</li>
    <li class="level3 nav-leaf"><a href="../04-organisation/boot-and-start-up.html">Boot &amp; Start Up</a></li>
    <li class="level3 nav-leaf"><a href="../04-organisation/game-entry-points.html">Game Entry Points</a></li>
    <li class="level3 nav-leaf"><a href="../04-organisation/scene-management.html">What are Scenes?</a></li>
    <li class="level3 nav-leaf"><a href="../04-organisation/subsystems.html">What SubSystems are</a></li>
    <li class="level2 nav-header">Platform &amp; IO</li>
    <li class="level3 nav-leaf"><a href="../05-platform/assets.html">Assets &amp; Asset Loading</a></li>
    <li class="level3 nav-leaf"><a href="../05-platform/configuration.html">Game Configuration</a></li>
    <li class="level3 nav-leaf"><a href="../05-platform/cross-platform-publishing.html">Cross Platform Publishing</a></li>
    <li class="level3 nav-leaf"><a href="../05-platform/importers.html">File Importers</a></li>
    <li class="level3 nav-leaf"><a href="../05-platform/input-handling.html">Input Handling</a></li>
    <li class="level3 nav-leaf"><a href="../05-platform/loading-and-saving-data.html">Loading &amp; Saving Data</a></li>
    <li class="level3 nav-leaf"><a href="../05-platform/logging.html">Logging</a></li>
    <li class="level3 nav-leaf"><a href="../05-platform/networking.html">Networking</a></li>
    <li class="level2 nav-header">Presentation</li>
    <li class="level3 nav-leaf"><a href="../06-presentation/animation.html">Animation</a></li>
    <li class="level3 nav-leaf"><a href="../06-presentation/audio.html">Audio</a></li>
    <li class="level3 nav-leaf"><a href="../06-presentation/boundaries.html">Boundaries</a></li>
    <li class="level3 nav-leaf"><a href="../06-presentation/cameras.html">Cameras</a></li>
    <li class="level3 nav-leaf"><a href="../06-presentation/clones-and-mutants.html">Clones &amp; Mutants</a></li>
    <li class="level3 nav-leaf"><a href="../06-presentation/depth.html">Depth</a></li>
    <li class="level3 nav-leaf"><a href="../06-presentation/layers.html">Layers</a></li>
    <li class="level3 nav-leaf"><a href="../06-presentation/lighting.html">Lighting</a></li>
    <li class="level3 nav-leaf"><a href="../06-presentation/materials.html">Materials</a></li>
    <li class="level3 nav-leaf"><a href="../06-presentation/primitives.html">Primitives &amp; Building Blocks</a></li>
    <li class="level3 nav-leaf"><a href="../06-presentation/scene-update-fragment.html">SceneUpdateFragment</a></li>
    <li class="level3 nav-leaf"><a href="../06-presentation/shapes.html">Shapes</a></li>
    <li class="level3 nav-leaf"><a href="../06-presentation/text-and-fonts.html">Text &amp; Fonts</a></li>
    <li class="level2 nav-header">Shaders</li>
    <li class="level3 nav-leaf"><a href="../07-shaders/blending.html">Blending</a></li>
    <li class="level3 nav-leaf"><a href="../07-shaders/constants.html">Shader Constants, Variables, and Outputs</a></li>
    <li class="level3 nav-leaf"><a href="../07-shaders/premultiplied-alpha.html">Premultiplied Alpha</a></li>
    <li class="level3 nav-leaf"><a href="../07-shaders/shaders-overview.html">Shaders Overview</a></li>
    <li class="level2 nav-header">Time</li>
    <li class="level3 nav-leaf"><a href="../08-time/gametime.html">GameTime</a></li>
    <li class="level3 nav-leaf"><a href="../08-time/signals.html">Signals &amp; Signal Functions</a></li>
    <li class="level3 nav-leaf"><a href="../08-time/time-varying-values.html">Time Varying Values</a></li>
    <li class="level2 nav-header">UI Components</li>
    <li class="level3 nav-leaf"><a href="../09-uicomponents/button.html">Buttons</a></li>
    <li class="level3 nav-leaf"><a href="../09-uicomponents/hit-area.html">Hit Areas</a></li>
    <li class="level3 nav-leaf"><a href="../09-uicomponents/input-field.html">Input Fields</a></li>
    <li class="level3 nav-leaf"><a href="../09-uicomponents/radio-button.html">Radio Buttons</a></li>
    <li class="level3 nav-leaf"><a href="../09-uicomponents/ui-components.html">UI Components</a></li>
    <li class="level2 nav-header">Misc</li>
    <li class="level3 nav-leaf"><a href="alternatives.html">Alternatives to Indigo</a></li>
    <li class="level3 active nav-leaf"><a href="#">Anti-Patterns</a></li>
    <li class="level3 nav-leaf"><a href="glossary.html">Glossary</a></li>
    <li class="level3 nav-leaf"><a href="key-concepts.html">Key Concepts</a></li>
    <li class="level3 nav-leaf"><a href="model-viewmodel-view.html">Model, ViewModel, &amp; View</a></li>
    <li class="level3 nav-leaf"><a href="motivation-and-constraints.html">Motivation &amp; Constraints</a></li>
    <li class="level3 nav-leaf"><a href="pathfinding.html">Path finding</a></li>
    <li class="level3 nav-leaf"><a href="performance.html">Performance</a></li>
    <li class="level3 nav-leaf"><a href="prior-art.html">Prior Art</a></li>
    <li class="level3 nav-leaf"><a href="rendering-technology.html">Rendering Technology</a></li>
    <li class="level2 nav-header">Physics</li>
    <li class="level3 nav-leaf"><a href="../11-physics/physics-overview.html">Physics Overview</a></li>
    <li class="level1 nav-node"><a href="../../examples/">Examples</a></li>
    <li class="level2 nav-node"><a href="../../examples/importers/">Importers</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/importers/tiled-loaded/">Loading Tiled maps at runtime</a></li>
    <li class="level2 nav-node"><a href="../../examples/materials/">Materials</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/materials/bitmap/">Bitmap material</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/materials/filltypes/">Fill Types</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/materials/imageeffects/">ImageEffects material</a></li>
    <li class="level2 nav-node"><a href="../../examples/physics/">Physics</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/physics/basics/">Basic Physics Example</a></li>
    <li class="level2 nav-node"><a href="../../examples/primitives/">Primitives</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/primitives/graphic/">The Graphic Primitive</a></li>
    <li class="level2 nav-node"><a href="../../examples/shaders/">Shaders</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/shaders/basic/">A basic custom shader</a></li>
    <li class="level2 nav-node"><a href="../../examples/ui/">Ui</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/ui/button/">UI Components: Button</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/ui/component-group/">UI Components: Component Group</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/ui/component-list/">UI Components: Component List</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/ui/custom/">UI Components: Custom Components</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/ui/hitarea/">UI Components: HitArea</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/ui/input/">UI Components: Label</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/ui/label/">UI Components: Label</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/ui/maskedpane/">UI Components: Masked Pane</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/ui/radiobuttons/">UI Components: Radio buttons</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/ui/scrollpane/">UI Components: Scroll Pane</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/ui/switch/">UI Components: Switch</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/ui/textarea/">UI Components: TextArea</a></li>
    <li class="level3 nav-leaf"><a href="../../examples/ui/window/">UI Components: Windows</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Anti-Patterns</a></p>

  <ul class="nav-list">
    <li class="level1 nav-node"><a href="#general-advice">General advice</a></li>
    <li class="level2 nav-leaf"><a href="#uni-directional-data-flows">Uni-directional data flows</a></li>
    <li class="level1 nav-node"><a href="#anti-patterns-and-traps">Anti-patterns and traps</a></li>
    <li class="level2 nav-leaf"><a href="#feedback">Feedback</a></li>
    <li class="level2 nav-leaf"><a href="#simultaneous-updates">Simultaneous updates</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="anti-patterns" class="title">Anti-Patterns</h1>
        <p>This page is an attempt to flag any anti-patterns, bad practices or traps that the authors have seen in the wild or have themselves fallen into! The hope is that but not repeating these mistakes your game dev&#39;ving will be more fun and fruitful.</p>
        
        <h2 id="general-advice" class="section"><a class="anchor-link left" href="#general-advice"><i class="icofont-laika link">&#xef71;</i></a>General advice</h2>
        
        <h3 id="uni-directional-data-flows" class="section"><a class="anchor-link left" href="#uni-directional-data-flows"><i class="icofont-laika link">&#xef71;</i></a>Uni-directional data flows</h3>
        <p>The main thing to remember when building in Indigo is that is follows a uni-directional data flow. That is to say that the data all goes in one direction.</p>
        
        <h2 id="anti-patterns-and-traps" class="section"><a class="anchor-link left" href="#anti-patterns-and-traps"><i class="icofont-laika link">&#xef71;</i></a>Anti-patterns and traps</h2>
        
        <h3 id="feedback" class="section"><a class="anchor-link left" href="#feedback"><i class="icofont-laika link">&#xef71;</i></a>Feedback</h3>
        <p>A common thing to do, is to organise your game model into a hierarchy of classes/objects, and then have methods that delegate or invoke methods on their sub-objects who in turn need to somehow update their parent. As you can imagine, this can get very hairy very quickly.</p>
        
        <h4 id="example-health-potions" class="section"><a class="anchor-link left" href="#example-health-potions"><i class="icofont-laika link">&#xef71;</i></a>Example: Health potions</h4>
        <p>In your game, all characters - player or otherwise - have an inventory:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Player</span><span>(</span><span class="identifier">health</span><span>: </span><span class="type-name">Int</span><span>, </span><span class="identifier">inventory</span><span>: </span><span class="type-name">Inventory</span><span>)</span></code></pre>
        <p>Your player can can pick up health potions around the game and store them in their inventory, which can only hold one health potion at a time. Lets model the inventory as dumbly as possible to keep this really simple:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">HealthPotion</span><span>
</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Inventory</span><span>(</span><span class="identifier">healthPotion</span><span>: </span><span class="type-name">Option</span><span>[</span><span class="type-name">HealthPotion</span><span>.</span><span class="keyword">type</span><span>]):

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">add</span><span>(</span><span class="identifier">hp</span><span>: </span><span class="type-name">HealthPotion</span><span>.</span><span class="keyword">type</span><span>): </span><span class="type-name">Inventory</span><span> = 
    </span><span class="keyword">this</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">healthPotion</span><span> = </span><span class="type-name">Some</span><span>(</span><span class="identifier">hp</span><span>))

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">use</span><span>: </span><span class="type-name">Inventory</span><span> =
    </span><span class="identifier">healthPotion</span><span> </span><span class="keyword">match</span><span>
      </span><span class="keyword">case</span><span> </span><span class="type-name">None</span><span> =&gt; </span><span class="keyword">this</span><span>
      </span><span class="keyword">case</span><span> </span><span class="type-name">Some</span><span>(</span><span class="identifier">hp</span><span>) =&gt; </span><span class="keyword">this</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">healthPotion</span><span> = </span><span class="type-name">None</span><span>)</span></code></pre>
        <p>We&#39;ve given it nice little <code>add</code> and <code>use</code> methods too! While we&#39;re at it, the player needs updating:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Player</span><span>(</span><span class="identifier">health</span><span>: </span><span class="type-name">Int</span><span>, </span><span class="identifier">inventory</span><span>: </span><span class="type-name">Inventory</span><span>):

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">add</span><span>(</span><span class="identifier">hp</span><span>: </span><span class="type-name">HealthPotion</span><span>.</span><span class="keyword">type</span><span>): </span><span class="type-name">Player</span><span> =
    </span><span class="keyword">this</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">inventory</span><span> = </span><span class="identifier">inventory</span><span>.</span><span class="identifier">add</span><span>(</span><span class="identifier">hp</span><span>))

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">use</span><span>: </span><span class="type-name">Player</span><span> =
    </span><span class="keyword">this</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">inventory</span><span> = </span><span class="identifier">inventory</span><span>.</span><span class="identifier">use</span><span>)</span></code></pre>
        <p>Now you can call <code>add</code> or <code>use</code> on player and it delegates through to the inventory and everything is immutably updated. Great.</p>
        <p>...there&#39;s some problems here though, lets look at two in particular:</p>
        <ol class="arabic">
          <li>What if we&#39;re already carrying a health potion and we try and insert another one?</li>
        </ol>
        <ol class="arabic">
          <li>The <code>use</code> method certainly removes the health potion from our possession, but how do we update the players health?</li>
        </ol>
        <p>The anti-pattern is to try and feedback to the parent directly, consider these modifications to our inventory methods:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="diff-removed">-def add(hp: HealthPotion): Inventory</span><span>
</span><span class="diff-added">+def add(hp: HealthPotion): (Inventory, Boolean)</span></code></pre>
        <p>Here we are adding a boolean to the return type to say &quot;succeeded in adding the potion&quot; (or not).</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="diff-removed">-def use: Inventory</span><span>
</span><span class="diff-added">+def use(player: Player): (Inventory, Player)</span></code></pre>
        <p>Here again we&#39;re going to inflate the return type so that now we can accept the player (our parent object), fiddle with it, and give it back... to itself... yuk!</p>
        
        <h4 id="solution-events" class="section"><a class="anchor-link left" href="#solution-events"><i class="icofont-laika link">&#xef71;</i></a>Solution: Events</h4>
        <p>Instead of doing any weird feedback with the return types, we can just use the <code>Outcome</code> type to fire off events, consider the following alternate inventory implementation:</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">indigo</span><span>.*

</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">CannotAddThis</span><span>(</span><span class="identifier">healthPotion</span><span>: </span><span class="type-name">HealthPotion</span><span>.</span><span class="keyword">type</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">GlobalEvent</span><span>
</span><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">NoHealthPotionToUse</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">GlobalEvent</span><span>
</span><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">IncreasePlayerHealth</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">GlobalEvent</span><span>

</span><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">AltInventory</span><span>(</span><span class="identifier">healthPotion</span><span>: </span><span class="type-name">Option</span><span>[</span><span class="type-name">HealthPotion</span><span>.</span><span class="keyword">type</span><span>]):

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">add</span><span>(</span><span class="identifier">hp</span><span>: </span><span class="type-name">HealthPotion</span><span>.</span><span class="keyword">type</span><span>): </span><span class="type-name">Outcome</span><span>[</span><span class="type-name">AltInventory</span><span>] =
    </span><span class="identifier">healthPotion</span><span> </span><span class="keyword">match</span><span>
      </span><span class="keyword">case</span><span> </span><span class="type-name">None</span><span> =&gt;
        </span><span class="type-name">Outcome</span><span>(</span><span class="keyword">this</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">healthPotion</span><span> = </span><span class="type-name">Some</span><span>(</span><span class="identifier">hp</span><span>)))

      </span><span class="keyword">case</span><span> </span><span class="type-name">Some</span><span>(</span><span class="identifier">_</span><span>) =&gt;
        </span><span class="type-name">Outcome</span><span>(</span><span class="keyword">this</span><span>)
          .</span><span class="identifier">addGlobalEvents</span><span>(</span><span class="type-name">CannotAddThis</span><span>(</span><span class="identifier">hp</span><span>))

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">use</span><span>: </span><span class="type-name">Outcome</span><span>[</span><span class="type-name">AltInventory</span><span>] =
    </span><span class="identifier">healthPotion</span><span> </span><span class="keyword">match</span><span>
      </span><span class="keyword">case</span><span> </span><span class="type-name">None</span><span> =&gt;
        </span><span class="type-name">Outcome</span><span>(</span><span class="keyword">this</span><span>)
          .</span><span class="identifier">addGlobalEvents</span><span>(</span><span class="type-name">NoHealthPotionToUse</span><span>)

      </span><span class="keyword">case</span><span> </span><span class="type-name">Some</span><span>(</span><span class="identifier">hp</span><span>) =&gt;
        </span><span class="type-name">Outcome</span><span>(</span><span class="keyword">this</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">healthPotion</span><span> = </span><span class="type-name">None</span><span>))
          .</span><span class="identifier">addGlobalEvents</span><span>(</span><span class="type-name">IncreasePlayerHealth</span><span>)</span></code></pre>
        <p>Now, when we consume a health potion we either report that there was one, or that the players health should be increased. Equally if we try to add a potion to an already full inventory, we report the problem and return the item. The events are collected on the next frame and actioned.</p>
        <p>This will require a change to our player too to make it work:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">final</span><span> </span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">AltPlayer</span><span>(</span><span class="identifier">health</span><span>: </span><span class="type-name">Int</span><span>, </span><span class="identifier">inventory</span><span>: </span><span class="type-name">AltInventory</span><span>):

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">add</span><span>(</span><span class="identifier">hp</span><span>: </span><span class="type-name">HealthPotion</span><span>.</span><span class="keyword">type</span><span>): </span><span class="type-name">Outcome</span><span>[</span><span class="type-name">AltPlayer</span><span>] =
    </span><span class="identifier">inventory</span><span>.</span><span class="identifier">add</span><span>(</span><span class="identifier">hp</span><span>).</span><span class="identifier">map</span><span> { </span><span class="identifier">inv</span><span> =&gt;
      </span><span class="keyword">this</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">inventory</span><span> = </span><span class="identifier">inv</span><span>)
    }

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">use</span><span>: </span><span class="type-name">Outcome</span><span>[</span><span class="type-name">AltPlayer</span><span>] =
    </span><span class="identifier">inventory</span><span>.</span><span class="identifier">use</span><span>.</span><span class="identifier">map</span><span> { </span><span class="identifier">inv</span><span> =&gt;
      </span><span class="keyword">this</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">inventory</span><span> = </span><span class="identifier">inv</span><span>)
    }</span></code></pre>
        <p>When we call <code>use</code>, it now returns an <code>Outcome[Inventory]</code> which we can map over (retaining any events created when we called <code>inventory.use</code>) and update our player.</p>
        <p>Note that we don&#39;t try and update the player&#39;s health yet. To do that we&#39;d add a new <code>increaseHealth</code> method to <code>AltPlayer</code> and have it invoked when the <code>updateModel</code> function receives the <code>IncreasePlayerHealth</code> event.</p>
        
        <h3 id="simultaneous-updates" class="section"><a class="anchor-link left" href="#simultaneous-updates"><i class="icofont-laika link">&#xef71;</i></a>Simultaneous updates</h3>
        <p>One place where uni-directional data flows begin to feel awkward and difficult, is when you need to update two things at once, where one&#39;s update depends on the other&#39;s update.</p>
        
        <h4 id="example-moving-bad-guys" class="section"><a class="anchor-link left" href="#example-moving-bad-guys"><i class="icofont-laika link">&#xef71;</i></a>Example: Moving bad guys</h4>
        <p>There are two bad guys moving on a grid towards the player. There is only one empty space in front of the player, but on the next turn, both bad guys could walk into that space, <em>unless</em> they were blocked by the other. Mapping over a list of bad guys is not sufficient because a <code>map</code> operation doesn&#39;t know how it&#39;s neighbours have been affected, and can only have the previous positions as context. In other words, if you just did <code>badguys.map(move)</code> they&#39;d both end up in the same space.</p>
        <p>What can you do?</p>
        
        <h4 id="solution-recursion" class="section"><a class="anchor-link left" href="#solution-recursion"><i class="icofont-laika link">&#xef71;</i></a>Solution: Recursion</h4>
        <p>If the updates must happen right now on this frame, then one solution is recursion. By processing each bad guy in turn and having the context of the updated bad guys so far available, you can avoid collisions.</p>
        <p>In pseudo-scala code:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="annotation">@tailrec</span><span>
</span><span class="keyword">def</span><span> </span><span class="declaration-name">moveBadGuys</span><span>(</span><span class="identifier">notMoved</span><span>: </span><span class="type-name">List</span><span>[</span><span class="type-name">BadGuy</span><span>], </span><span class="identifier">moved</span><span>: </span><span class="type-name">List</span><span>[</span><span class="type-name">BadGuy</span><span>]): </span><span class="type-name">List</span><span>[</span><span class="type-name">BadGuy</span><span>] =
  </span><span class="identifier">notMoved</span><span> </span><span class="keyword">match</span><span>
    </span><span class="keyword">case</span><span> </span><span class="type-name">Nil</span><span> =&gt; </span><span class="identifier">moved</span><span>
    </span><span class="keyword">case</span><span> </span><span class="identifier">nextBadGuy</span><span> :: </span><span class="identifier">remainingBadGuys</span><span> =&gt;
      </span><span class="keyword">val</span><span> </span><span class="identifier">nextPosition</span><span> =
        </span><span class="comment">// decide next position while checking for conflicts
</span><span>        </span><span class="comment">// within `moved`.
</span><span>        ???
      </span><span class="identifier">moveBadGuys</span><span>(</span><span class="identifier">remainingBadGuys</span><span>, </span><span class="identifier">nextBadGuy</span><span>.</span><span class="identifier">move</span><span>(</span><span class="identifier">nextPosition</span><span>) :: </span><span class="identifier">moved</span><span>)</span></code></pre>

        
<hr class="footer-rule"/>
<footer>
  Site generated by <a href="https://typelevel.org/Laika/">Laika</a> with the Helium theme.
</footer>


      </main>

    </div>

  </body>

</html>